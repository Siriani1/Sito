<!DOCTYPE html>
<html>
<head>
  <title>Leaflet mobile example</title>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link 
   rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin="">
  </script>


  <style>
    
    #mapid { 
        height: 600px; 
        width: 100%;
    
    }
    ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #333;
    }
    
    li {
        float: left;
        display: block;
        color: white;
        text-align: center;
        padding: 10px 12px;
        text-decoration: none;
    }
    
    
    </style>
</head>
<body>
    <div class="container">
        <ul>
            <li><h1>Hi {{session.username}}</h1></li>
            <li><h1><a href="{{ url_for('logout') }}">Logout</a></h1></li>
        </ul>
    </div>

    <div id="mapid"></div>

    <script>
      if('geolocation' in navigator) {
            console.log('geolocation is available')
            navigator.geolocation.getCurrentPosition(position => {
            console.log(position)
            let latitude = position.coords.latitude
            let longitude = position.coords.longitude
            const mymap = L.map('mapid').setView([latitude, longitude], 15);
            const tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
            const attribution = 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            L.tileLayer(tileUrl, { attribution, maxZoom:18 }).addTo(mymap);
            const marker = L.marker([latitude, longitude]).addTo(mymap).bindPopup("You are here");
            var x = {{df | safe}};
            //var x = [[9.17,45.45]]
            for(var i = 0; i < x.length; i++){
                //console.log('ciao')
                g = new L.marker([x[i][1], x[i][0]]).addTo(mymap).bindPopup(x[i][2]);
            }
            }); 
        } else {
            console.log('geolocation IS NOT available')
        }
        
      
    </script>
</body>
</html> 

